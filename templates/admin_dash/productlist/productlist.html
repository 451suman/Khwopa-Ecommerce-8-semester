{% extends "admin_dash/base.html" %}
{% block content %}
<div class="page-wrapper">
	<div class="page-content">

		<!-- Search Bar & Create Button -->
		<div class="row">
			<div class="col-12">
				<div class="card">
					<div class="card-body">
						<div class="row align-items-center">
							<div class="col-lg-3 col-xl-2">
								<a href="" class="btn btn-primary mb-3 mb-lg-0">
									<i class='bx bxs-plus-square'></i> New Product
                                    {{request.user.is_vendor}}
								</a>
							</div>
							<div class="col-lg-9 col-xl-10">
								<form class="float-lg-end" method="get">
									<div class="row row-cols-lg-auto g-2">
										<div class="col-12">
											<div class="position-relative">
												<input type="text" name="search" value="{{ search }}" class="form-control ps-5" placeholder="Search Product...">
												<span class="position-absolute top-50 product-show translate-middle-y">
													<i class="bx bx-search"></i>
												</span>
											</div>
										</div>
									</div>
								</form>
							</div>
						</div>
					</div>
				</div>
			</div>
		</div>

		<!-- Product Cards -->
		<div class="row row-cols-1 row-cols-sm-2 row-cols-lg-3 row-cols-xl-4 row-cols-xxl-5 product-grid">
			{% for product in products %}
			<div class="col">
				<div class="card product-card position-relative overflow-hidden">

					<div class="position-relative">
						{% with product.product_images.all|first as first_image %}
							{% if first_image %}
							<img class="card-img-top primary-photo" style="width: 250px !important; height: 250px !important;" src="{{ first_image.image.url }}" alt="{{ product.name }}">
							{% endif %}
						{% endwith %}

					</div>

					<div class="card-body">
						<h6 class="card-title">{{ product.name }}</h6>
						<div class="clearfix">
							{% if product.previous_price %}
							<p class="mb-0 float-end fw-bold">
								<span class="me-2 text-decoration-line-through text-secondary">
									${{ product.previous_price }}
								</span>
								<span>${{ product.current_price }}</span>
							</p>
							{% else %}
							<p class="mb-0 float-end fw-bold">${{ product.current_price }}</p>
							{% endif %}
						</div>

						<div class="d-flex align-items-center mt-3 fs-6">
							<div class="cursor-pointer">
								{% for i in "12345" %}
									{% if forloop.counter <= product.avg_rating|default:0 %}
										<i class='bx bxs-star text-warning'></i>
									{% else %}
										<i class='bx bxs-star text-secondary'></i>
									{% endif %}
								{% endfor %}
							</div>
							<p class="mb-0 ms-auto">{{ product.review_count }} Reviews</p>
						</div>
					</div>
				</div>
			</div>
			{% empty %}
			<div class="col-12">
				<div class="alert alert-warning text-center">No products found.</div>
			</div>
			{% endfor %}
		</div>

		<!-- Pagination -->
		<div class="mt-4">
			{% if is_paginated %}
			<nav aria-label="Page navigation">
				<ul class="pagination justify-content-center">
					{% if page_obj.has_previous %}
					<li class="page-item">
						<a class="page-link" href="?page={{ page_obj.previous_page_number }}{% if search %}&search={{ search }}{% endif %}">Previous</a>
					</li>
					{% endif %}

					{% for page_num in paginator.page_range %}
					<li class="page-item {% if page_num == page_obj.number %}active{% endif %}">
						<a class="page-link" href="?page={{ page_num }}{% if search %}&search={{ search }}{% endif %}">
							{{ page_num }}
						</a>
					</li>
					{% endfor %}

					{% if page_obj.has_next %}
					<li class="page-item">
						<a class="page-link" href="?page={{ page_obj.next_page_number }}{% if search %}&search={{ search }}{% endif %}">Next</a>
					</li>
					{% endif %}
				</ul>
			</nav>
			{% endif %}
		</div>

	</div>
</div>

{% endblock %}
